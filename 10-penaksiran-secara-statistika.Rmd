# (PART\*) Statistika Inferensi - R {-}

<style>
body{
text-align: justify}
</style>

# Penaksiran Secara Statistika

Pada Chapter 6-Ringkasan Numerik kita telah belajar beberapa atribut kunci dari data seperti $\overline{X}$ dan $s$. Kedua nilai tersebut disebut sebagai nilai estimasi sampel dari populasi (untuk mean $\mu$ dan simpangan baku $\sigma$). Pada Chapter ini kita akan melakukan eksplorasi lebih jauh lagi mengenai interval estimasi (*interval estimate*) yang akan menyinggung kedua nilai tersebut lebih jauh.

## Definisi Interval Estimasi

Median sampel dan mean sampel menyatakan titik pemusatan data. Estimasi menggunakan kedua nilai tersebut disebut sebagai itu disebut estimasi titik (*point estimation*). Estimasi titik sendiri tidak menggambarkan reliabilitas  atau kurangnya reliabilitas (variabilitas) dari estimasi ini. Sebagai contoh, anggaplah terdapat dua data X dan Y dengan mean 5 dengan jumlah observasi yang sama. Data Y memiliki nilai mean 5 dengan sangat sedikit variasi didalamnya, sedangkan data X jauh lebih bervariasi. Perkiraan titik 5 untuk X jauh lebih tidak dapat diandalkan dibandingkan dengan untuk Y karena variabilitas yang lebih besar dalam data X. Dengan kata lain, lebih banyak kehati-hatian diperlukan ketika menyatakan bahwa 5 memperkirakan mean populasi sebenarnya X daripada ketika menyatakan ini untuk Y. Melaporkan hanya perkiraan mean sampel (poin) 5 gagal memberikan petunjuk tentang perbedaan ini.

Sebagai alternatif untuk estimasi titik, estimasi interval adalah interval yang memiliki probabilitas yang dinyatakan mengandung nilai populasi sebenarnya. interval lebih lebar untuk set data yang memiliki variabilitas lebih besar. Jadi dalam contoh di atas, interval antara 4,7 dan 5,3 mungkin memiliki kemungkinan 95% untuk mengandung mean populasi Y yang sebenarnya (tidak diketahui). Butuh interval yang jauh lebih luas, katakanlah antara 2,0 dan 8,0, untuk memiliki probabilitas yang sama untuk mengandung rerata sebenarnya dari X. Karena itu, perbedaan keandalan dari dua estimasi dengan jelas dinyatakan menggunakan estimasi interval. Estimasi interval dapat memberikan dua informasi yang estimasi poin tidak dapat berikan, antara lain:

1. Pernyataan probabilitas atau kemungkinan bahwa interval berisi nilai populasi sebenarnya (keandalannya).
2. Pernyataan kemungkinan bahwa satu titik data dengan besaran tertentu berasal dari populasi yang diteliti.

Estimasi interval untuk poin pertama disebut sebagai interval kepercayaan (*confidence interval*), sedangkan yang kedua disebut sebagai interval prediksi (*prediction interal*). Meskipun salin terkait, pembaca perlu berhati-hati sebab kedua definisi tersebut sering kali tertukar satu sama lain.

## Interpretasi Interval Estimasi

Untuk lebih memahami mengenai definisi interval estimasi pada sub-chapter ini akan diberikan contoh yang diambil dari buku **statistical Methods in Water Resources** karya Helsel dan Hirsch (2012). Misalkan mean populasi sebenarnya $\mu$ konsentrasi dalam akuifer adalah 10. Sleain itu, anggaplah bahwa varians populasi sebenarnya $\sigma^2$ sama dengan 1. Karena nilai-nilai ini dalam praktiknya tidak pernah diketahui, sampel diambil untuk memperkirakannya dengan mean sampel $x$ dan sampel varianss $s^2$ . Dana yang cukup tersedia untuk mengambil 12 sampel air (kira-kira satu per bulan) selama satu tahun, dan hari-hari di mana pengambilan sampel terjadi dipilih secara acak. Dari 12 sampel ini $x$x dan $s^2$ dihitung. Meskipun pada kenyataannya hanya satu set 12 sampel akan diambil setiap tahun, menggunakan komputer 12 hari dapat dipilih beberapa kali untuk menggambarkan konsep perkiraan interval. Untuk masing-masing dari 10 set independen dari 12 sampel, interval kepercayaan pada mean dihitung dengan menggunakan persamaan yang diberikan pada Tabel \@ref(tab:iie) dan Gambar \@ref(fig:iievis).

**No.** | **N** | **Mean** | **St.Dev** | **90% Interval kepercayaan**
--------|-------|----------|------------|--------------------------
1       | 12    | 10,06    | 1,11       | 9,46 sampai 10,64
2       | 12    | 10,60    | 0,81       | $^+$ 10,18 sampai 11,02
3       | 12    | 9,95     | 1,26       | 9,29 sampai 10,60
4       | 12    | 10,18    | 1,26       | 9,52 sampai 10,83
5       | 12    | 10,17    | 1,33       | 9,48 sampai 10,85
6       | 12    | 10,22    | 1,19       | 9,60 sampai 10,84
7       | 12    | 9,71     | 1,51       | 8,92 sampai 10,49
8       | 12    | 9,90     | 1,01       | 9,38 sampai 10,43
9       | 12    | 9,95     | 0.10       | 9,43 sampai 10,46
10      | 12    | 9,88     | 1,37       | 9,17 sampai 10,59

: (\#tab:iie) Sepuluh  interval kepercayaan 90% sekitar nilai mean sebenarnya sebesar 10 (Data berdistribusi normal dan Tanda plus menyatakan data tidak disertakan dalam nilai mean sebenarnya)

Kesepuluh interval pada contoh di atas disebut dengan dengan **interval kepercayaan 90%** dari nilai mean sesungguhnya. Nilai mean sebenarnya akan terdapat pada interval tersebut dengan probabilitas 90%. Sehingga berdasarkan Tabel \@ref(tab:iie) terdapat 9 interval yang memiliki nilai mean sesungguhnya didalamnya (probabilitas 90%). Jika kita sekali lagi melakukan sampling dengan jumlah sampling yang sama pada interval nilai baru yang dihasilkan akan mengandung nilai mean sesungguhnya dan dapat juga tidak. Probabilitas interval tersebut mengandung nilai mean sesungguhnya disebut sebagai **tingkat kepercayaan** (*confidence level*). Probabilitas nilai interval tidak mengandung mean sesungguhnya disebut sebagai **alpha level** ($\alpha$) yang ditulis berdasarkan Persamaan \@ref(eq:alpha).

\begin{equation}
  \alpha=1-confidence\ level\ 
  (\#eq:alpha)
\end{equation}

Lebar interval kepercayaan adalah fungsi dari bentuk distribusi data (variabilitas dan kemencengannya), ukuran sampel, dan tingkat kepercayaan yang diinginkan. Ketika tingkat kepercayaan meningkat, lebar interval juga meningkat, karena interval yang lebih besar lebih mungkin mengandung nilai sebenarnya daripada interval yang lebih pendek. Dengan demikian interval kepercayaan 95% akan lebih luas daripada interval 90% untuk data yang sama.

```{r iievis, echo=FALSE, fig.cap='Sepuluh interval kepercayaan 90 persen data dengan nilai mean sebenarnya 10', tidy=FALSE, out.width='65%', fig.align='center'}
library(knitr)
img1_path <- "iievis.png"
include_graphics(img1_path)
```

Interval kepercayaan simetris pada rata-rata biasanya dihitung dengan asumsi data mengikuti distribusi normal. Jika tidak, distribusi rerata itu sendiri akan mendekati normal sepanjang ukuran sampel besar (katakanlah 50 pengamatan atau lebih besar). Interval kepercayaan dengan asumsi normalitas kemudian akan memasukkan mean sebenarnya ($1-\alpha$)% dari waktu. Dalam contoh di atas, data dihasilkan dari distribusi normal, sehingga ukuran sampel kecil 12 tidak menjadi masalah. Namun ketika data memiliki kemencengan dan ukuran sampel di bawah 50 atau lebih, interval kepercayaan simetris tidak akan mengandung rata-rata ($1-\alpha$)% sepanjang waktu. Dalam contoh di bawah ini, interval kepercayaan simetris secara salah dihitung untuk data yang miring (Gambar \@ref(fig:iiedata)). Hasil (Gambar \@ref(fig:iievis2) dan Tabel \@ref(tab:iie2)) menunjukkan bahwa interval kepercayaan kehilangan nilai sebenarnya dari 1 lebih sering daripada yang seharusnya. Semakin besar skewness, semakin besar ukuran sampel harus sebelum interval kepercayaan simetris dapat diandalkan. Sebagai alternatif, interval kepercayaan asimetris dapat dihitung untuk situasi umum data yang memiliki kemencengan. 


**No.** | **N** | **Mean** | **St.Dev** | **90% Interval kepercayaan**
--------|-------|----------|------------|--------------------------
1       | 12    | 0,784    | 0,320      | $^+$ 0,618 sampai 0,950
2       | 12    | 0,811    | 0,299      | $^+$ 0,656 sampai 0,966
3       | 12    | 1,178    | 0,700      | 0,815 sampai 1,541
4       | 12    | 1,030    | 0,459      | 0,792 sampai 1,267
5       | 12    | 1,079    | 0,573      | 0,782 sampai 1,376
6       | 12    | 0,833    | 0,363      | 0,644 sampai 1,021
7       | 12    | 0,789    | 0,240      | $^+$ 0,644 sampai 0,913
8       | 12    | 1,159    | 0,815      | 0,736 sampai 1,581
9       | 12    | 0,822    | 0,365      | $^+$ 0,633 sampai 0,992
10      | 12    | 0,837    | 0,478      | 0,589 sampai 1,085

: (\#tab:iie2) Sepuluh  interval kepercayaan 90% sekitar nilai mean sebenarnya sebesar 1 (Data tidak berdistribusi normal dan Tanda plus menyatakan data tidak disertakan dalam nilai mean sebenarnya)

```{r iiedata, echo=FALSE, fig.cap='Histogram data dengan nilai mean populasi 1 dan simpangan baku populasi 0.75', tidy=FALSE, out.width='70%', fig.align='center'}
library(knitr)
img1_path <- "iiedata.png"
include_graphics(img1_path)
```


```{r iievis2, echo=FALSE, fig.cap='Sepuluh interval kepercayaan 90 persen data dengan nilai mean sebenarnya 1', tidy=FALSE, out.width='65%', fig.align='center'}
library(knitr)
img1_path <- "iievis2.png"
include_graphics(img1_path)
```

## Interval Kepercayaan Median

Interval kepercayaan median populasi dapat dihitung tanpa perlu mengikuti asumsi distribusi tertentu. Sehingga nilai median dapat digunakan untuk memperkirakan nilai pusat data untuk distribusi data yang tidak berdistribusi normal.

### Interval Estimasi Median Metode Nonparametrik

Interval estimasi nonparametrik untuk median populasi sebenarnya dihitung menggunakan distribusi binomial. Pertama, tingkat signifikansi yang diinginkan $\alpha$ dinyatakan, error yang dapat diterima tidak termasuk median yang sebenarnya. Satu-setengah ($\alpha/2$) dari error ini digunakan untuk setiap akhir interval (Gambar \@ref(fig:iemednp)). Tabel distribusi binomial memberikan nilai kritis bawah dan atas $x'$ dan $x$ pada setengah tingkat alfa yang diinginkan ($\alpha/2$). Nilai-nilai kritis ini ditransformasikan ke dalam rangking $R_l$ dan $R_u$ yang sesuai dengan titik data $C_l$ dan $C_u$ di ujung interval kepercayaan.

```{r iemednp, echo=FALSE, fig.cap='Probabilitas median populasi P50 pada dua sisi interval estimasi.', tidy=FALSE, out.width='65%', fig.align='center'}
library(knitr)
img1_path <- "iemednp.png"
include_graphics(img1_path)
```

Untuk ukuran sampel kecil, tabel binomial dimasukkan pada kolom p = 0,5 (median) untuk menghitung interval kepercayaan pada median.  Nilai kritis $x'$ diperoleh dari tabel distribusi binomial yang sesuai dengan $\alpha/2$, atau sedekat mungkin dengan $\alpha/2$. Nilai kritis ini kemudian digunakan untuk menghitung peringkat $R_u$ dan $R_l$ yang sesuai dengan nilai data pada batas kepercayaan atas dan bawah untuk median. Batas-batas ini adalah titik data peringkat $R_l$th yang masuk dari setiap ujung daftar n  observasi. Interval kepercayaan yang dihasilkan akan mencerminkan bentuk (menceng atau simetris) dari data asli.

\begin{equation}
  R_l=x'+1 
  (\#eq:rl)
\end{equation}

\begin{equation}
  R_u=n-x'=x\ untuk\ x'\ dan\ x\ dari\ tabel\ dist.\ binomial 
  (\#eq:ru)
\end{equation}

Interval nonparametrik tidak selalu dapat secara tepat menghasilkan tingkat kepercayaan yang diinginkan ketika ukuran sampel kecil. Ini karena mereka terpisah, melompat dari satu nilai data ke yang berikutnya di ujung interval. Namun, tingkat kepercayaan yang dekat dengan yang diinginkan tersedia untuk semua kecuali ukuran sampel terkecil.

Untuk lebih memahaminya diberikan data 25 pengukuran konsentrasi arsenin di air tanah dalam ppb yang disajikan pada Tabel \@ref(tab:gwardat).

```{r gwardat,echo=FALSE}
library(tibble)

gwardat <- tribble(
  ~observasi, ~konsentrasi,
  #--/----
  1, 1.3,
  2, 1.5,
  3, 1.8,
  4, 2.6,
  5, 2.8,
  6, 3.5,
  7, 4.0,
  8, 4.8,
  9, 8.0,
  10, 9.5,
  11, 12,
  12, 14,
  13, 19,
  14, 23,
  15, 41,
  16, 80,
  17, 100,
  18, 110,
  19, 120,
  20, 190,
  21, 240,
  22, 250,
  23, 300,
  24, 340,
  25, 580
)

knitr::kable(
  gwardat, caption = 'Konsentrasi Arsenik dalam air tanah (ppb)'
)
```

Visualisasi Tabel \@ref(tab:gwardat) ditunjukkan pada Gambar \@ref(fig:gwardatvis). Berdasarkan gambar tersebut terlihat bahwa data memiliki kemencengan yang positif sehingga penaksiran rata-rata populasi menggunakan nilai mean tidak dapat dilakukan.

```{r gwardatvis, echo=FALSE, fig.cap='Distribusi konsentrasi arsenik dalam air tanah', tidy=FALSE, out.width='70%', fig.align='center'}
library(ggplot2)
library(ggthemes)

ggplot(gwardat, aes(konsentrasi, fill=..count..))+
  geom_histogram(bins=13)+
  theme_economist()+
  xlab("konsentrasi (ppb)")
```

Berdasarkan data pada Tabel \@ref(tab:gwardat), median konsentrasi arsenik $\hat{C}_{0.5}$=`r median(gwardat$konsentrasi)` yang berada pada urutan data ke-13 dari data yang telah diurutkan dari yang terkecil ke yang terbesar. Untuk menentukan interval kepercayaan 95% median kosentrasi arsenik $C_{0.5}$, nilai kritis berdasarkan nilai error mendekati $\alpha/2$=0,025 adalah $x'$=7. Untuk lebih memahaminya pembaca dapat mengunduh tabel distribusi binomial pada laman [berikut](https://onlinepubs.trb.org/onlinepubs/nchrp/cd-22/manual/v2appendixc.pdf). Nilai $x'$=7 diperoleh menggunakan Tabel distribusi binomial dengan $n$=25 dan $p$=0,5 yang ditampilkan pada Gambar \@ref(fig:tabbinom) dengan nilai probabilitas sebesar 0,022 (mendekati 0,025) yang setara dengan area yang diarsir pada Gambar \@ref(fig:iemednp).

```{r tabbinom, echo=FALSE, fig.cap='Lokasi probabilitas x berdasarkan tabel distribusi binomial', tidy=FALSE, out.width='65%', fig.align='center'}
library(knitr)
img1_path <- "tabbinom.png"
include_graphics(img1_path)
```

Berdasarkan Persamaan \@ref(eq:rl) dan Persamaan \@ref(eq:ru), rangking $R_l$ pada observasi yang menyatakan batas kepercayaan bawah (*lower confidence limit*) adalah 8 ($R_i$=7+1) dan $R_u$ yang menyatakan batas kepercayaan atas (*upper confidence level*) adalah 25-7=18. Berdasarkan nilai probabilitas $x'$=0,022, maka nilai alpha yang sesunggunya sebesar $\alpha=2*0,022=0,044$. Nilai tersebut setara dengan tingkat kepercayaan $1-0,044$ atau 95,6%. Nilai interval kepercayaan median antara observasi ke-8 dan 18 adalah $C_l=4,8\le C_{0.5}\le110=C_u\ \ pada\ \alpha=0,044$. Nilai asimetrik disekitar $\hat{C}_{0.5}$=19 mencerminkan kemencengan pada data.

Jika pembaca ingin melakukan perhitungan pada `R`, pembaca harus membuat fungsi sebagai berikut:

```{r}
med_npCI <- function(x,alpha){
  n=length(x)
  med = median(x)
  for(i in 1:n){
    b = pbinom(i,n,0.5)
    if(b>alpha/2){
      break
    }
  }
  # mengambil x'
  x_i=i-1
  # menghitung Rl dan Ru
  rl=x_i+1
  ru=n-x_i
  # menghitung true confidence level
  CL=1-2*(pbinom(x_i,n,0.5))
  # menghitung Lower dan Upper CL
  LCL=x[rl]
  UCL=x[ru]
  # menggabungkannya dalam satu data
  data=data.frame("median"=med,
                  "True CL %"=CL*100,
                  "Lower CL"=LCL,
                  "Upper CL"=UCL)
  return(data)
}
```

Fungsi yang telah dibuat tersebut selanjutnya dapat pembaca gunakan saat akan menghitung interval kepercayaan median populasi menggunakan metode Nonparametrik. Berikut penerapannya menggunakan data pada Tabel \@ref(tab:gwardat) yang telah disimpan kedalam objek `gwardat`.

```{r}
med_npCI(x=gwardat$konsentrasi, alpha=0.05)
```

Alternatif lain yang dapat digunakan untuk menghitung interval kepercayaan jika sampel cukup besar n>20 menggunakan metode Nonparametrik adalah dengan menggunakan pendekatan tabel distribusi normal untuk memperkirakan distribusi binomial. Dengan menggunakan pendekatan ini, hanya sebagian kecil tabel distribusi binomial (n=20) yang diperlukan untuk melakukannya. Nilai kritis $z_{\alpha/2}$ dari tabel distribusi normal menentukan rangking atas dan  bawah observasi yang menyatakan awal dan akhir nilai interval kepercayaan yang dinyatakan pada Persamaan \@ref(eq:rlz) dan Persamaan \@ref(eq:ruz). Pembulatan diperlukan dalam proses ini sebab nilai ranking harus berupa integer.

\begin{equation}
  R_l=\frac{n-z_{\frac{\alpha}{2}}\cdot\sqrt{n}}{2} 
  (\#eq:rlz)
\end{equation}

\begin{equation}
   R_l=\frac{n-z_{\frac{\alpha}{2}}\cdot\sqrt{n}}{2}+1
  (\#eq:ruz)
\end{equation}

Menggunakan contoh data pada Tabel \@ref(tab:gwardat), dengan 95% interval kepercayaan ($z_{\alpha/2}$=1,96) median dapat dihitung seperti berikut:

\begin{equation}
  R_l=\frac{25-1,96\cdot\sqrt{25}}{2}=7,6 
\end{equation}

\begin{equation}
  R_l=\frac{25+1,96\cdot\sqrt{25}}{2}+1=18,4 
\end{equation}

Berdasarkan hasil perhitungan diperoleh rangking bawah adalah data ke-8 dan rangking atas adalah 18. Kedua data dibulatkan berdasarkan integer terdekat. Nilai interval kepercayaan median yang diperoleh sama dengan metode sebelumnya sebab rangking batas bawah dan atasnya yang seragam.

Jika pembaca ingin menggunakan `R`, maka fungsi yang sebelumya telah kita buat dapat dimodifikasi seperti berikut:

```{r}
med_norCI <- function(x, alpha){
  n = length(x)
  med = median(x)
  # menghitung Rl dan Ru
  rl=round((n-abs(qnorm(alpha/2))*sqrt(n))/2,0)
  ru=round(((n+abs(qnorm(alpha/2))*sqrt(n))/2)+1,0)
  # menghitung Lower dan Upper CL
  LCL=x[rl]
  UCL=x[ru]
  # menggabungkannya dalam satu data
  data=data.frame("median"=med,
                  "Lower CL"=LCL,
                  "Upper CL"=UCL)
  return(data)
}
```

```{r}
med_norCI(x=gwardat$konsentrasi, alpha=0.05)
```

### Metode Parametrik Interval Estimasi Median

Telah dijelaskan pada chapter 6 bahwa rata-rata geometrik  merupakan merupakan nilai rata-rata yang digunakan untuk mengestimasi median sampel untuk data yang memiliki kemencengan dengan transformasi yang digunakan agar data simetrik adalah transformasi logaritmik $y=\ln(x)$. Pada metode ini data diasumsikan memiliki distribusi lognormal (kemencengan positif). Rerata dan interval geometris akan lebih efisien (interval lebih pendek) dari median dan interval kepercayaannya ketika data benar-benar lognormal. Median sampel dan intervalnya lebih tepat dan lebih efisien jika logaritma data masih menunjukkan kemencengan dan/atau *outlier*. Estimasi media menggunakan metode parametrik dituliskan kedalam Persamaan \@ref(eq:gmci) dan Persamaan \@ref(eq:gmci2).

\begin{equation}
  GM_x=\exp\left(\overline{y}\right) 
  (\#eq:gmci)
\end{equation}

dimana $y=\ln(x)$ dan $\overline{y}$=mean sampel $y$.

\begin{equation}
  \exp\left(\overline{y}-t_{\left(\frac{\alpha}{2},n-1\right)}\sqrt{\frac{s_y^2}{n}}\right)\le GM_x\le\exp\left(\overline{y}+t_{\left(\frac{\alpha}{2},n-1\right)}\sqrt{\frac{s_y^2}{n}}\right) 
  (\#eq:gmci2)
\end{equation}

dimana $s_{y}^2$= varians sampel y pada unit log natural.

Pada Tabel \@ref(tab:gwardat), untuk menghitung interval keyakinan median menggunakan pendekatan mean geometrik $GM_x$ kita perlu mentransformasi datanya terlebih dahulu sehingga menjadi bentuk natural log. hasil transformasi disajikan pada Tabel \@ref(tab:gwardat2).

```{r gwardat2,echo=FALSE}
gwardat2<-gwardat
gwardat2$konsentrasi<-log(gwardat2$konsentrasi)

knitr::kable(
  gwardat2, caption = 'Tranformasi logaritmik konsentrasi Arsenik dalam air tanah (ppb)'
)
```

visualisasi distribusi yang baru disajikan pada Gambar \@ref(fig:gwardatvis2).

```{r gwardatvis2, echo=FALSE, fig.cap='Distribusi logaritmik konsentrasi arsenik dalam air tanah', tidy=FALSE, out.width='70%', fig.align='center'}
ggplot(gwardat2, aes(konsentrasi, fill=..count..))+
  geom_histogram(bins=7)+
  theme_economist()+
  xlab("log konsentrasi (ppb)")
```

Nilai mean dari data tersebut adalah 3,17 dengan simpangan baku sebesar 1,96. Berdasarkan Gambar \@ref(fig:gwardatvis2), kita telah memperoleh distribusi yang simetris.

Dengan menggunakan Persamaan \@ref(eq:gmci) dan Persamaan \@ref(eq:gmci2) selanjutnya dapat dihitung interval kepercayaannya dengan derajat kepercayaan 95%.

\begin{equation}
  GM_x=\exp\left(3,17\right)=23,8
\end{equation}

\begin{equation}
  \exp\left(3.17-2,064\cdot\sqrt{\frac{1.96^2}{25}}\right)\le GM_x\le\exp\left(3.17-2,064\cdot\sqrt{\frac{1.96^2}{25}}\right)
\end{equation}

\begin{equation}
  \exp\left(2,36\right)\le GM_x\le\exp\left(3,98\right)
\end{equation}

\begin{equation}
  10,6\le GM_x\le53,5
\end{equation}

Dengan menggunakan `R` dapat dikerjakan menggunakan fungsi sebagai berikut:

```{r}
# persamaan hanya dapat digunakan untuk data yang telah ditransformasi lognormal

med_gm <- function(x, alpha){
  # rata-rata geometrik
  gm = exp(mean(x))
  # menghitung derajat kebebasan
  df = length(x)-1
  # menghitung batas bawah dan atas
  LCL = exp(mean(x)-qt(1-alpha/2,df)*sqrt(var(x)/length(x)))
  UCL = exp(mean(x)+qt(1-alpha/2,df)*sqrt(var(x)/length(x)))
  # menggabungkan hasil
  data=data.frame("GM"=gm,
                  "Lower CL"=LCL,
                  "Upper CL"=UCL)
  return(data)
}
```

```{r}
med_gm(x=gwardat2$konsentrasi, alpha=0.05)
```

Pembaca perlu berhati-hati dalam menentukan apakah akan menggunakan metode Nonparametrik atau parametrik. Jika data berditribusi lognormal kita dapat menggunakan metode parametrik.

## Interval Kepercayaan Mean

Estimasi interval juga dapat dihitung untuk mean populasi sebenarnya $\mu$. Hal ini sangat sesuai jika pusat data menjadi fokus dalam analisa statistik. Interval simetris di sekitar sampel rata-rata X paling sering dihitung. Untuk ukuran sampel besar, interval simetris secara memadai menggambarkan variasi rata-rata, terlepas dari bentuk distribusi data. Ini karena distribusi rata-rata sampel akan mendekati dengan distribusi normal ketika ukuran sampel semakin besar, meskipun data mungkin tidak terdistribusi secara normal. Untuk ukuran sampel yang lebih kecil, rata-rata tidak akan didistribusikan secara normal kecuali jika data itu sendiri terdistribusi secara normal. Ketika data meningkat kemencengannya, lebih banyak data diperlukan sebelum distribusi rata-rata dapat didekati secara memadai oleh distribusi normal. Untuk distribusi yang sangat miring atau data yang mengandung *outlier*, mungkin diperlukan lebih dari 100 pengamatan sebelum nilai rata-rata tidak akan terpengaruh oleh nilai terbesar untuk mengasumsikan bahwa distribusinya akan simetris.

### Interval Kepercayaan Mean Untuk Distribusi Yang Simetris

Interval kepercayaan mean untuk distribusi simetris dihitung menggunakan tabel distribusi *student's t* yang tersedia dalam buku teks statistik dan perangkat lunak. Tabel ini dimasukkan untuk menemukan nilai kritis untuk t pada setengah tingkat alfa yang diinginkan. Pada buku lain sering dijelaskan bahwa distribusi t hanya digunakan untuk sampel kecil (beberapa menyebutkan n<30), sedangkan untuk distribusi besar digunakan distribusi normal. Penggunaan distribusi normal jarang digunakan dalam prakiraan. Hal ini disebabkan karena pada proses perhitungan diperlukan nilai simpangan baku $\sigma$. Pada kenyataannya pada pengukuran dilapangan kita sering sekalin melakukan estimasi terhadap simpangan baku melalui sampel $s$ karena kita tidak mengetahui nilai simpangan baku populasinya sehingga pada buku ini akan digali lebih jauh metode estimasi interval menggunakan persamaan distribusi t.

Lebar interval kepercayaan adalah fungsi dari nilai-nilai kritis dari tabel distribusi t, standar deviasi data, dan ukuran sampel. Ketika data memiliki kemecengan atau mengandung *outlier*, asumsi di balik interval t dan distribusi normal tidak berlaku. Interval simetris yang dihasilkan akan sangat luas sehingga sebagian besar pengamatan akan dimasukkan di dalamnya. Ini juga dapat mencapai di bawah nol di ujung bawah. Titik akhir negatif dari interval kepercayaan untuk data yang tidak dapat menjadi negatif adalah sinyal yang jelas bahwa asumsi interval kepercayaan simetris tidak diperlukan. Untuk data tersebut, dengan asumsi distribusi lognormal seperti yang dijelaskan dalam sub chapter sebelumnya (interval kepercayaan median) akan lebih tepat. Interval kepercayaan dihitung menggunakan Persamaan \@ref(eq:pmeancisim).

\begin{equation}
  \overline{x}-t_{\left(\frac{\alpha}{2},n-1\right)}\cdot\sqrt{\frac{s^2}{n}}\le\mu\le\overline{x}+t_{\left(\frac{\alpha}{2},n-1\right)}\cdot\sqrt{\frac{s^2}{n}}
  (\#eq:pmeancisim)
\end{equation}

Untuk lebih memahami cara penerapannya, kita akan menggunakan kembali data pada Tabel \@ref(tab:gwardat2). Langkah pertama yang perlu dilakukan adalah menghitung mean sampel $\overline{x}$ dan simpangan baku sampel $s$. Berdasarkan hasil perhitungan diperoleh nilai $\overline{x}$ =`r round(mean(gwardat$konsentrasi),3)` dan $s$ = `r round(sd(gwardat$konsentrasi), 3)`. Dengan meggunakan Persamaan \@ref(eq:pmeancisim), interval estimasi mean dengan tingkat kepercayaan 95% dapat dihitung sebagai berikut:

\begin{equation}
  3,17\ -\ t_{\left(0.25,24\right)}\cdot\sqrt{1,\frac{96^2}{25}}\le\mu\le3,17\ -\ t_{\left(0.25,24\right)}\cdot\sqrt{1,\frac{96^2}{25}}
\end{equation}

\begin{equation}
  2,36\le\mu\le3,98
\end{equation}

Berdasarkan hasil yang diperoleh terdapat 95% peluang nilai mean populasi $\mu$ terletak pada interval 2,36 sampai 3,98. Perlu diingat bahwa metode parametrik sangat sensitif dengan adanya *outlier* sehingga jika pembaca ingin menggunakannya pastikan terlebih dahulu tidak ada *outlier* pada data dengan cara melakukan visualisasi data.

Pada `R` kita dapat menggunakan fungsi `stat.desc()` untuk menhitung statistika deskriptif serta interval kepercayaan mean-nya. Berikut adalah sintaks yang digunakan:

```{r, message=FALSE}
# memuat paket
library(pastecs)

# ringkasan data
r=stat.desc(gwardat2$konsentrasi)
r

# batas bawah (LCL)
mean(gwardat2$konsentrasi)-r[[11]]

# batas atas (UCL)
mean(gwardat2$konsentrasi)+r[[11]]
```

### Interval Kepercayaan Mean Untuk Distribusi Yang Asimetris

Mean dan interval kepercayaan dapat dihitung dengan mengasumsikan distribusi data mengikuti distribusi logaritmik $y=\ln{(x)}$. Metode ini berguna untuk jenis data yang memiliki bentuk distribusi data yang memiliki kemencengan positif (perlu transformasi logaritmik agar simetris).Metode ini memberikan perkiraan rata-rata yang lebih dapat diandalkan (varians lebih rendah) daripada perhitungan rata-rata sampel biasa tanpa transformasi log.

Untuk memperkirakan rata-rata populasi $\mu_x$ dalam unit aslinya, anggap datanya berdistribusi normal. Satu-setengah varians logaritma ditambahkan ke $\overline{y}$ (rata-rata log) sebelum eksponensial. Karena varianss sampel $s^2_y$ hanya perkiraan varianss sebenarnya dari logaritma, estimasi sampel rata-rata akan menjadi bias. Namun, untuk sampel dengan $s^2_y$ kecil dan ukuran sampel besar bias dapat diabaikan. Interval kepercayaan dapat dituliskan berdasarkan Persamaan \@ref(eq:pmeanciasim).

\begin{equation}
  \mu_x=\exp\left(\overline{y}+0,5\cdot s_y^2\right)
  (\#eq:pmeanciasim)
\end{equation}

dimana $y=\ln{(x)}$, $\overline{y}$= mean sampel dan $s^2_y$= varians sampel y dalam unit log natural.

Interval kepercayaan sekitar $\mu_x$ bukan estimasi interval yang dihitung untuk rata-rata geometri dalam Persamaan \@ref(eq:gmci2). Interval kepercayaan tidak dapat dihitung hanya dengan mengekspansi interval sekitar $\overline{y}$. Interval kepercayaan yang tepat dalam satuan asli untuk rata-rata data lognormal dapat dihitung. Untuk lebih jelasnya pembaca dapat melihatnya pada situs <http://jse.amstat.org/v13n1/olsson.html>.

Metode Cox dapat digunakan untuk menghitung interval keyakinan dengan nilai estimasi rata-rata menggunakan Persamaan \@ref(eq:pmeanciasim). Persamaan yang digunakan dapat dituliskan sebagai berikut (Persamaan \@ref(eq:pmeanciasimci)).

\begin{equation}
  \ln\left(\mu_x\right)=\overline{Y}+\frac{s_y^2}{2}\pm z_{\left(\frac{\alpha}{2}\right)}\sqrt{\frac{s_y^2}{n}+\frac{s_y^4}{2\left(n-1\right)}}
  (\#eq:pmeanciasimci)
\end{equation}

Persamaan \@ref(eq:pmeanciasimci) dapat dimodifikasi dengan menggunakan distribusi t dibanding menggunakan distribusi normal. Penggunaan distribusi t akan memperbaiki kelemahan penggunaan distribusi normal pada sampel yang berukuran kecil.

Data Tabel \@ref(tab:gwardat) dapat kita gunakan untuk menghitung rata-rata menggunakan Persamaan \@ref(eq:pmeanciasimci). Hal ini disebabkan karena data yang ada memiliki kemencengan positif sehingga dapat dianggap bahwa transformasi logaritmik dapat membentuk distribusi ini menjadi lebih simetris. 

Berdasarkan hasil perhitungan diperoleh nilai $\overline{Y}$ =`r round(mean(gwardat2$konsentrasi),3)` dan $s^2_y$ = `r round(sd(gwardat2$konsentrasi), 3)`. Sehingga nilai interval selanjutnya dapat dihitung menggunakan Persamaan \@ref(eq:pmeanciasimci) dengan interval keyakinan 95%.

\begin{equation}
  \ln\left(\mu_x\right)=3,17+\frac{1,96^2}{2}\pm1,96\sqrt{\frac{1,96^2}{25}+\frac{1,96^4}{2\left(25-1\right)}}
\end{equation}

\begin{equation}
  \ln\left(\mu_x\right)=5,10\pm1,33
\end{equation}

Sehingga

\begin{equation}
  \exp\left(5,10-1,33\right)\le\mu_x\le\exp\left(5,10+1,33\right)
\end{equation}

\begin{equation}
  43,38\le\mu_x\le620,17
\end{equation}

Nilai interval yang dihasilkan sangat panjang sehingga nilai rata-rata yang dihasilkan tidak dapat diandalkan untuk memperkirankan lokasi nilai mean populasi. 

Pada contoh berikut akan disajikan sintaks untuk menghitung interval kepercayaan mean data pada Tabel \@ref(tab:gwardat) berdasarkan Persamaan \@ref(eq:pmeanciasimci) dan sitribusi yang digunakan adalah distribusi t. Pembaca dapat memodifikasi sintaks berikut jika ingin menggunakan distribusi normal.

```{r}
mean_asci<-function(x,alpha){
  m=mean(x)
  # mean data hasil transformasi logaritmik
  ave = mean(log(x))
  # simpangan baku data hasil transformasi
  sd = sd(log(x))
  # jumlah observasi
  n = length(x)
  # derajat kebebasa
  df = n-1
  # interval keyakinan satu sisi
  re = 1-(alpha/2)
  # CI menggunakan distribusi t
  LCL = exp(ave+(0.5*sd^2)-qt(re,df)*sqrt(((sd^2)/n)+((sd^4)/(2*df))))
  UCL = exp(ave+(0.5*sd^2)+qt(re,df)*sqrt(((sd^2)/n)+((sd^4)/(2*df))))
  # menggabungkan hasil
  data = data.frame("Mean"=m,
                  "Lower CL"=LCL,
                  "Upper CL"=UCL)
  return(data)
}
```

```{r}
mean_asci(x=gwardat$konsentrasi, alpha=0.05)
```

## Interval Prediksi Nonparametrik

Pertanyaan yang sering diajukan adalah apakah satu pengamatan baru kemungkinan berasal dari distribusi yang sama dengan data yang dikumpulkan sebelumnya, atau sebagai alternatif dari distribusi yang berbeda. Pertanyaan dapat dievaluasi dengan menentukan apakah pengamatan baru di luar interval prediksi yang dihitung dari data yang ada. Interval prediksi mengandung $100*(1 − \alpha)$ persen dari distribusi data, sementara $100*\alpha$ persen berada di luar interval. Jika pengamatan baru datang dari distribusi yang sama dengan data yang diukur sebelumnya, ada kemungkinan $100*\alpha$ persen bahwa pengamatan baru tersebut akan berada di luar interval prediksi. Karena pengamatan baru tersebut berada di luar interval tidak "membuktikan" pengamatan baru itu berbeda, hanya saja sepertinya begitu. Seberapa besar kemungkinan ini tergantung pada pilihan $\alpha$ yang ditentukan oleh peneliti.

Interval prediksi dihitung dengan tujuan yang berbeda dari interval kepercayaan. Interval prediksi terkait dengan nilai data individu yang berlawanan dengan ringkasan statistik seperti nilai mean. Interval prediksi lebih luas daripada interval kepercayaan, karena pengamatan individu lebih bervariasi daripada ringkasan statistik yang dihitung dari beberapa pengamatan. Tidak seperti interval kepercayaan, interval prediksi memperhitungkan variabilitas titik data tunggal di sekitar median atau rata-rata, di samping kesalahan dalam memperkirakan pusat distribusi. Ketika mean $\pm$ 2 standar deviasi secara keliru digunakan untuk memperkirakan lebar interval prediksi, data baru dinyatakan berasal dari populasi yang berbeda lebih sering daripada yang seharusnya.

### Interval Prediksi Nonparametrik Dua Sisi

Interval prediksi tingkat kepercayaan nonparametrik α secara sederhana dinyatakan sebagai interval antara persentil distribusi $\alpha/2$ dan $1− (\alpha/2)$ (Gambar \@ref(fig:ipnds)). Interval ini mengandung $100*(\alpha/2)$ data, sedangkan $100*\alpha$ persen berada di luar interval. Oleh karena itu jika titik data tambahan baru berasal dari distribusi yang sama dengan data yang diukur sebelumnya, ada kemungkinan $100*\alpha$ persen bahwa itu akan berada di luar interval prediksi. Interval akan mencerminkan bentuk data yang dikembangkannya, dan tidak ada asumsi tentang bentuk bentuk yang perlu dibuat. Interval prediksi nonparametrik dua sisi dinyatakan berdasarkan Persamaan \@ref(eq:eqipnds).

\begin{equation}
  PI_{np}=X_{\frac{\alpha}{2}\cdot\left(n+1\right)}\ sampai\ dengan\ X_{\left[1-\left(\frac{\alpha}{2}\right)\right]\cdot\left(n+1\right)}
  (\#eq:eqipnds)
\end{equation}

```{r ipnds, echo=FALSE, fig.cap='Prediksi interval dua sisi', tidy=FALSE, out.width='65%', fig.align='center'}
library(knitr)
img1_path <- "ipnds.png"
include_graphics(img1_path)
```

Kita akan kembali menggunakan data pada Tabel \@ref(tab:gwardat). Dengan menggunakan tingkat kepercayaan 90% kita diminta untuk menentukan interval prediksi dari konsentrasi arsenik pada data tersebut tanpa mengasumsikan distribusi dari data.

Untuk melakukannya kita perlu menentukan observasi ke-2,5 dan 97,5 (berdasarkan nilai $\alpha/2$) dengan rangking observasi berdasarkan Persamaan \@ref(eq:eqipnds) adalah $(0,05*26)$ atau rangking observasi antara observasi 1 ($R_1$) dan 2 ($R_2$) dan $(0,95*26)$ rangking observasi antara observasi 24 ($R_{24}$) dan 25 ($R_{25}$). Dengan menggunakan interpolasi linier pada observasi ke-1, 2 , 24 dan 25, interval prediksi yang diperoleh adalah sebagai berikut:

\begin{equation}
  X_1+\left(\frac{R_{\left(0.05\cdot26\right)}-R_1}{R_2-R_1}\right)\cdot\left(X_2-X_1\right)\ sampai\ dengan\ X_{24}+\left(\frac{R_{\left(0.95\cdot26\right)}-R_{24}}{R_{25}-R_{24}}\right)\cdot\left(X_{25}-X_4\right)
\end{equation}

\begin{equation}
  1,3+\left(\frac{1,3-1}{2-1}\right)\cdot\left(1,5-1,3\right)\ sampai\ dengan\ 340+\left(\frac{24,5-24}{25-24}\right)\cdot\left(580-340\right)
\end{equation}

\begin{equation}
  1,4\ sampai\ dengan\ 508\ ppb
\end{equation}

Observasi baru diluar rentang tersebut akan dianggap berasal dari distribusi yang berbeda dengan tingkat error sebesar 10% ($\alpha$=10%).

Dengan menggunakan `R` pembaca depat menghitung interval prediksi menggunakan fungsi berikut:

```{r}
PInp <- function(x, alpha){
  # jumlah observasi
  n = length(x)
  # menghitung alpha masing-masing sisi
  err <- alpha/2
  # menentukan rangkin observasi sesuai alpha
  rl = err*(n+1)
  ru = (1-err)*(n+1)
  # menentukan observasi untuk interpolasi linier
  rl_1= ceiling(rl) # bulatkan ke bawah
  rl_2= floor(rl) # bulatkan ke atas
  ru_1= ceiling(ru) 
  ru_2= floor(ru)
  # menentukan interval prediksi
  LPI = round(x[rl_1]+((rl-rl_1)/(rl_2-rl_1))*(x[rl_2]-x[rl_1]),1)
  UPI = round(x[ru_1]+((ru-ru_1)/(ru_2-ru_1))*(x[ru_2]-x[ru_1]),1)
  # menggabungkan hasil
  data = data.frame("Lower PI"=LPI,
                    "Upper PI"=UPI)
  return(data)
}
```

```{r}
PInp(x=gwardat$konsentrasi, alpha=0.1)
```

### Interval Prediksi Nonparametrik Satu Sisi

Interval prediksi satu sisi digunakan jika kita ingin mengecek apakah pengamatan baru lebih besar dari data yang ada, atau lebih kecil dari data yang ada, tetapi tidak keduanya. Keputusan untuk menggunakan interval satu sisi harus didasarkan sepenuhnya pada pertanyaan yang menarik. Seharusnya tidak ditentukan setelah melihat data dan memutuskan bahwa pengamatan baru cenderung hanya lebih besar, atau hanya lebih kecil, daripada informasi yang ada. Interval satu sisi menggunakan $\alpha$ dibanding $\alpha/2$ sebagai nilai error, menempatkan semua erro di satu sisi interval (Gambar \@ref(fig:ipss)). Interval prediksi dituliskan berdasarkan Persamaan \@ref(eq:eqipss).

```{r ipss, echo=FALSE, fig.cap='Prediksi interval satu sisi', tidy=FALSE, out.width='65%', fig.align='center'}
library(knitr)
img1_path <- "ipss.png"
include_graphics(img1_path)
```

\begin{equation}
  PI_{np}:\ x_{baru}<X_{\alpha\cdot\left(n+1\right)}\ atau\ x_{baru}>X_{\left[1-\alpha\right]\cdot\left(n+1\right)}
  (\#eq:eqipss)
\end{equation}

Untuk memahami penerapannya, misalkan kita memiliki nilai arsenik baru dengan konsentrasi 355 ppb. Kita perlu menentukan apakah nilai tersebut lebih besar dari sebagian besar data yang ada.

Dengan menggunakan Persamaan \@ref(eq:eqipss) dan $\alpha$=0,1 atau tingkat kepercayaan 90%, interval prediksi satu sisi atau data teratas dari persentil ke-90 dari data yang ada adalah $X_{0,9}*26=X_{23,4}$. Dengan menggunakan interpolasi linier pada observasi data dengan rangking ke-23 ($R_{23}$) dan 24 ($R_{23}$) diperoleh:

\begin{equation}
  X_{23}+0,4\cdot\left(X_{24}-X_{23}\right)=300+0,4\cdot40=316\ ppb
\end{equation}

Berdasarkan data yang diperoleh diketahui bahwa batas atas dari interval prediksi adalah 316<355 pbb, sehingga disimpulkan bahwa konsentrasi 355 pbb lebih besar dari sebagian besar data yang ada.

Dengan menggunakan `R` interval prediksi menggunakan satu sisi dapat dihitung menggunakan fungsi berikut:

```{r}
PInp_os <- function(x, obs, alpha, side){
  # jumlah observasi
  n = length(x)
  # rangking observasi
  ru=(1-alpha)*(n+1)
  ru_1=ceiling(ru)
  ru_2=floor(ru)
  rl=alpha*(n+1)
  rl_1=ceiling(rl)
  rl_2=floor(rl)
  # perhitungan interval atas dan bawah
  PIup = x[ru_1]+((ru-ru_1)/(ru_2-ru_1))*(x[ru_2]-x[ru_1])
  PIdown = x[rl_1]+((rl-rl_1)/(rl_2-rl_1))*(x[rl_2]-x[rl_1])
  # decision making
  if((side=="upper") & (PIup<obs)){
    cat("PI =",PIup,"\nnilai observasi lebih besar dibadingkan sebagian besar nilai yang ada")
  } else if((side=="lower") & (PIdown>obs)){
    cat("PI =",PIdown,"\nnilai observasi lebih kecil dibadingkan sebagian besar nilai yang ada")
  } else if(side==""){
    print("side belum ditentukan tentukan apakah lower atau upper")
  } else{
    cat("batas bawah =",PIdown,", batas atas =",PIup,"\nnilai observasi sama dengan sebagian besar nilai yang ada")
  }
}
```

```{r}
PInp_os(x=gwardat$konsentrasi, obs=355, alpha=0.1, side="upper")
```

